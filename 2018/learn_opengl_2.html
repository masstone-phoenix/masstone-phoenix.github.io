<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="Keywords" content="blog"/>
    <meta name="Description" content="blog"/>
    <title>Simple</title>
    <link rel="shortcut icon" href="/static/favicon.png"/>
    <link rel="stylesheet" type="text/css" href="/main.css" />
</head>
<body>
<div class="main">
    <div class="header">
    	<ul id="pages">
            <li><a href="/">home</a></li>
            <li><a href="/#/tags">tags</a></li>
            <li><a href="/#/archive">archive</a></li>
    	</ul>
    </div>
	<div class="wrap-header">
	<h1>
    <a href="/" id="title"></a>
	</h1>
	</div>
<div id="md" style="display: none;">
<!-- markdown -->
这是一个学习OpenGL的系列，我也不知道会写到什么时候。。。[上篇文章](https://masstone-phoenix.github.io/2018/learn_opengl_1.html)已经学习了一些基础知识，这篇文章主要在iOS中搭建一个OpenGL的环境，如果篇幅不长的话就写一个简单的程序绘制一个三角形，如果太长就在下一篇中继续绘制。

#在iOS中使用OpenGL
我们遵照[苹果的官方步骤](https://developer.apple.com/library/content/documentation/3DDrawing/Conceptual/OpenGLES_ProgrammingGuide/OpenGLESontheiPhone/OpenGLESontheiPhone.html)，一步一步来：

1. 先确定使用OpenGL ES的版本，然后创建一个OpenGL ES context。
2. 在使用OpenGL ES过程中，检测context是否支持。
3. 选择一个渲染的目的地。
4. 确定程序能正确的运行在iOS中.

剩下的写一个渲染引擎这个已经超出了这个教程的范围了，就省略了。

总结一下，在类似iOS的平台上使用openGL，需要平台提供两个条件：一是创建openGL的rendering context；一是提供openGL绘制的目的framebuffer。


## 创建OpenGL ES context
我们决定使用OpenGL ES 3.0版本，因为目前iOS 7.0以上，GPU在Apple A7 GPU以上支持这个版本，而世面上大家使用的iPhone基本都满足这个条件，当然，如果不支持，可以考虑使用OpenGL ES 2.0进行兼容，这里就不考虑这种情况了（但在代码里写了这种），如下：

```
EAGLContext* CreateBestEAGLContext()
{
   EAGLContext *context = [[EAGLContext alloc] initWithAPI:kEAGLRenderingAPIOpenGLES3];
   if (context == nil) {
      context = [[EAGLContext alloc] initWithAPI:kEAGLRenderingAPIOpenGLES2];
   }
   return context;
}
```
这里需要说明一下，虽然EAGLContext持有OpenGL ES的状态，但是EAGLContext并不直接管理OpenGL objects，而是下面这张图这样，通过EAGLSharegroup来管理。

![](https://developer.apple.com/library/content/documentation/3DDrawing/Conceptual/OpenGLES_ProgrammingGuide/Art/eaglContext_eagleSharegroup_2x.png)




## 选择一个渲染的目的地
首先，创建工程，加入OpenGLES.framework、GLKit.framework和QuartzCore.framework

其次，创建OpenGL的运行环境，这里我参考了这个[教程](http://t-machine.org/index.php/2013/09/08/opengl-es-2-basic-drawing/)中的步骤：

1. Instantiate a GLKViewController with a Storyboard or NIB that assigns a GLKView to its “self.view” property
2. Subclass GLKViewController and override the “viewDidLoad” method to do OpenGL setup
3. Subclass GLKViewController and override the “update” method to do your OpenGL rendering
4. *Ignore* the “delegate callback” inside GLKView – it will prevent you using some advanced OpenGL features later on

使用GLKViewController以及GLKView，在GLKViewController的```- (void)update```方法中进行数据的更新等，在GLKViewController的 ```(void)glkView:(GLKView *)view drawInRect:(CGRect)rect```方法中完成绘制。

```
- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
    // Create an OpenGL ES context and assign it to the view loaded from storyboard
    GLKView *view = (GLKView *)self.view;
    view.context = CreateBestEAGLContext();
    [EAGLContext setCurrentContext:view.context];
    
    // Configure renderbuffers created by the view
    view.drawableColorFormat = GLKViewDrawableColorFormatRGBA8888;
    view.drawableDepthFormat = GLKViewDrawableDepthFormat24;
    view.drawableStencilFormat = GLKViewDrawableStencilFormat8;
    
    // Enable multisampling
    view.drawableMultisample = GLKViewDrawableMultisample4X;
}
/**
 *  进行一些渲染所需要的计算，在渲染时直接使用结果
 */
- (void)update {

}


/**
 *  渲染场景代码
 */
- (void)glkView:(GLKView *)view drawInRect:(CGRect)rect
{
    glClearColor(0.1f, 0.1f, 0.1f, 1.0f);
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); // we're not using the stencil buffer now
    glEnable(GL_DEPTH_TEST);
    //first box beauty at face
    glUseProgram(_quadShader);
    glBindVertexArray(_cubeVAO);
    glActiveTexture(GL_TEXTURE0);
    glBindTexture(GL_TEXTURE_CUBE_MAP, _cubeTexture);
    glDrawArrays(GL_TRIANGLES, 0, 36);
    glBindVertexArray(0);
}
```




<!-- markdown end -->
</div>
<div class="entry" id="main">
<!-- content -->
<p>这是一个学习OpenGL的系列，我也不知道会写到什么时候。。。<a href="https://masstone-phoenix.github.io/2018/learn_opengl_1.html">上篇文章</a>已经学习了一些基础知识，这篇文章主要在iOS中搭建一个OpenGL的环境，如果篇幅不长的话就写一个简单的程序绘制一个三角形，如果太长就在下一篇中继续绘制。</p>

<h1 id="iosopengl">在iOS中使用OpenGL</h1>

<p>我们遵照<a href="https://developer.apple.com/library/content/documentation/3DDrawing/Conceptual/OpenGLES_ProgrammingGuide/OpenGLESontheiPhone/OpenGLESontheiPhone.html">苹果的官方步骤</a>，一步一步来：</p>

<ol>
<li>先确定使用OpenGL ES的版本，然后创建一个OpenGL ES context。</li>
<li>在使用OpenGL ES过程中，检测context是否支持。</li>
<li>选择一个渲染的目的地。</li>
<li>确定程序能正确的运行在iOS中.</li>
</ol>

<p>剩下的写一个渲染引擎这个已经超出了这个教程的范围了，就省略了。</p>

<p>总结一下，在类似iOS的平台上使用openGL，需要平台提供两个条件：一是创建openGL的rendering context；一是提供openGL绘制的目的framebuffer。</p>

<h2 id="openglescontext">创建OpenGL ES context</h2>

<p>我们决定使用OpenGL ES 3.0版本，因为目前iOS 7.0以上，GPU在Apple A7 GPU以上支持这个版本，而世面上大家使用的iPhone基本都满足这个条件，当然，如果不支持，可以考虑使用OpenGL ES 2.0进行兼容，这里就不考虑这种情况了（但在代码里写了这种），如下：</p>

<pre><code>EAGLContext* CreateBestEAGLContext()
{
&nbsp;&nbsp; EAGLContext *context = [[EAGLContext alloc] initWithAPI:kEAGLRenderingAPIOpenGLES3];
&nbsp;&nbsp; if (context == nil) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context = [[EAGLContext alloc] initWithAPI:kEAGLRenderingAPIOpenGLES2];
&nbsp;&nbsp; }
&nbsp;&nbsp; return context;
}
</code></pre>

<p>这里需要说明一下，虽然EAGLContext持有OpenGL ES的状态，但是EAGLContext并不直接管理OpenGL objects，而是下面这张图这样，通过EAGLSharegroup来管理。</p>

<p><img src="https://developer.apple.com/library/content/documentation/3DDrawing/Conceptual/OpenGLES_ProgrammingGuide/Art/eaglContext_eagleSharegroup_2x.png" alt="" title=""></p>

<h2 id="">选择一个渲染的目的地</h2>

<p>首先，创建工程，加入OpenGLES.framework、GLKit.framework和QuartzCore.framework</p>

<p>其次，创建OpenGL的运行环境，这里我参考了这个<a href="http://t-machine.org/index.php/2013/09/08/opengl-es-2-basic-drawing/">教程</a>中的步骤：</p>

<ol>
<li>Instantiate a GLKViewController with a Storyboard or NIB that assigns a GLKView to its “self.view” property</li>
<li>Subclass GLKViewController and override the “viewDidLoad” method to do OpenGL setup</li>
<li>Subclass GLKViewController and override the “update” method to do your OpenGL rendering</li>
<li><em>Ignore</em> the “delegate callback” inside GLKView – it will prevent you using some advanced OpenGL features later on</li>
</ol>

<p>使用GLKViewController以及GLKView，在GLKViewController的<code>- (void)update</code>方法中进行数据的更新等，在GLKViewController的 <code>(void)glkView:(GLKView *)view drawInRect:(CGRect)rect</code>方法中完成绘制。</p>

<pre><code>- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
    // Create an OpenGL ES context and assign it to the view loaded from storyboard
    GLKView *view = (GLKView *)self.view;
    view.context = CreateBestEAGLContext();
    [EAGLContext setCurrentContext:view.context];

    // Configure renderbuffers created by the view
    view.drawableColorFormat = GLKViewDrawableColorFormatRGBA8888;
    view.drawableDepthFormat = GLKViewDrawableDepthFormat24;
    view.drawableStencilFormat = GLKViewDrawableStencilFormat8;

    // Enable multisampling
    view.drawableMultisample = GLKViewDrawableMultisample4X;
}
/**
 *  进行一些渲染所需要的计算，在渲染时直接使用结果
 */
- (void)update {

}


/**
 *  渲染场景代码
 */
- (void)glkView:(GLKView *)view drawInRect:(CGRect)rect
{
    glClearColor(0.1f, 0.1f, 0.1f, 1.0f);
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); // we're not using the stencil buffer now
    glEnable(GL_DEPTH_TEST);
    //first box beauty at face
    glUseProgram(_quadShader);
    glBindVertexArray(_cubeVAO);
    glActiveTexture(GL_TEXTURE0);
    glBindTexture(GL_TEXTURE_CUBE_MAP, _cubeTexture);
    glDrawArrays(GL_TRIANGLES, 0, 36);
    glBindVertexArray(0);
}
</code></pre>
<!-- content end -->
</div>
<br>
<br>
    <div id="disqus_thread"></div>
	<div class="footer">
		<p>© Copyright 2014 by isnowfy, Designed by isnowfy</p>
	</div>
</div>
<script src="main.js"></script>
<script id="content" type="text/mustache">
    <h1>{{title}}</h1>
    <div class="tag">
    {{date}}
    {{#tags}}
    <a href="/#/tag/{{name}}">#{{name}}</a>
    {{/tags}}
    </div>
</script>
<script id="pagesTemplate" type="text/mustache">
    {{#pages}}
    <li>
        <a href="{{path}}">{{title}}</a>
    </li>
    {{/pages}}
</script>
<script>
$(document).ready(function() {
    $.ajax({
        url: "main.json",
        type: "GET",
        dataType: "json",
        success: function(data) {
            $("#title").html(data.name);
            var pagesTemplate = Hogan.compile($("#pagesTemplate").html());
            var pagesHtml = pagesTemplate.render({"pages": data.pages});
            $("#pages").append(pagesHtml);
            //path
            var path = "2018/learn_opengl_2.html";
            //path end
            var now = 0;
            for (var i = 0; i < data.posts.length; ++i)
                if (path == data.posts[i].path)
                    now = i;
            var post = data.posts[now];
            var tmp = post.tags.split(" ");
            var tags = [];
            for (var i = 0; i < tmp.length; ++i)
                if (tmp[i].length > 0)
                    tags.push({"name": tmp[i]});
            var contentTemplate = Hogan.compile($("#content").html());
            var contentHtml = contentTemplate.render({"title": post.title, "tags": tags, "date": post.date});
            $("#main").prepend(contentHtml);
            if (data.disqus_shortname.length > 0) {
                var disqus_shortname = data.disqus_shortname;
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            }
        }
    });
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ["\\(", "\\)"]], processEscapes: true}});
</script>
</body>
</html>
